<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Миний бичиг баримт бүрдэлт -->
        <template id="nomin_web.my_tenders_documents_details_edit" name="Тендерийн шаардлага">
            <t t-call="website.layout" >
                <div id="content_wrapper">
                    <div class="container">
                    <div class="content-bg">
                        <div class="row">
                        <div class="col-sm-9 col-md-9">
                            <h3 class="pagetitle">Тендерийн бичиг баримт </h3>
                            <form action="/save_tender/documents/" method="post" class="s_website_form form-horizontal container-fluid" enctype="multipart/form-data">
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                <input type="hidden" name="participant" t-att-value="participant"/>
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="proxy"> Итгэмжлэл</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="proxy" accept=".pdf" class="form-control"/></t>
                                        <t t-if="part_tenders.t_partner_proxy_id"><t t-foreach="part_tenders.t_partner_proxy_id" t-as="proxy_id">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % proxy_id['id']"><t t-esc="proxy_id['datas_fname']"/></a></t>
                                        </t>
                                    </div>
                                </div>
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="technical"> Техникийн үзүүлэлт</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="technical" accept=".pdf" class="form-control"/></t>
                                        <t t-if='part_tenders.t_partner_technical_id'>
                                        <t t-foreach="part_tenders.t_partner_technical_id" t-as="technical">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % technical['id']"><t t-esc="technical['datas_fname']"/></a>
                                        </t>
                                        </t>
                                    </div>
                                </div>
                                <t t-if="tender.work_experience_info > 0">
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="work_list"> Ажиллах хүчний чадавхи</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="work_list" accept=".pdf" class="form-control"/></t>
                                        <t t-if='part_tenders.t_partner_worklist_id'>
                                        <t t-foreach="part_tenders.t_partner_worklist_id" t-as="work_list">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % work_list['id']"><t t-esc="work_list['datas_fname']"/></a>
                                            <!-- <a><t t-esc="work_list['datas_fname']"/></a> -->
                                        </t>
                                        </t>
                                    </div>
                                </div>
                                </t>
                                <t t-if="tender.special_require != ''">
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="requirement"> Тусгай шаардлагууд</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="requirement" accept=".pdf" class="form-control"/></t>
                                        <t t-if='part_tenders.t_partner_require_id'>
                                        <t t-foreach="part_tenders.t_partner_require_id" t-as="requirement">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % requirement['id']"><t t-esc="requirement['datas_fname']"/></a>
                                            <!-- <a><t t-esc="requirement['datas_fname']"/></a> -->
                                        </t>
                                        </t>
                                    </div>
                                </div>
                                </t>
                                <t t-if="tender.license == True">
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="license"> Тусгай зөвшөөрөл</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="license" accept=".pdf" class="form-control"/></t>
                                        <t t-if='part_tenders.t_partner_license_id'>
                                        <t t-foreach="part_tenders.t_partner_license_id" t-as="license">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % license['id']"><t t-esc="license['datas_fname']"/></a>
                                            <!-- <a><t t-esc="license['datas_fname']"/></a> -->
                                        </t>
                                        </t>
                                    </div>
                                </div>
                                </t>
                                <t t-if="tender.is_alternative == True">
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="alternative"> Хувилбарт тендер</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="alternative" accept=".pdf" class="form-control"/></t>
                                        <t t-if='part_tenders.t_partner_alternative_id'>
                                        <t t-foreach="part_tenders.t_partner_alternative_id" t-as="alternative">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % alternative['id']"><t t-esc="alternative['datas_fname']"/></a>
                                            <!-- <a><t t-esc="alternative['datas_fname']"/></a> -->
                                        </t>
                                        </t>
                                    </div>
                                </div>
                                </t>
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="cost"> Үнийн санал</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="cost" accept=".pdf" class="form-control"  /></t>
                                        <t t-if='part_tenders.t_partner_cost_id'>
                                        <t t-foreach="part_tenders.t_partner_cost_id" t-as="cost">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % cost['id']"><t t-esc="cost['datas_fname']"/></a>
                                            <!-- <a><t t-esc="cost['datas_fname']"/></a> -->
                                        </t>
                                        </t>
                                    </div>
                                </div>
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="schedule"> Ажлын график</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><input type="file" name="schedule" accept=".pdf" class="form-control"/></t>
                                        <t t-if='part_tenders.t_partner_schedule_id'>
                                        <t t-foreach="part_tenders.t_partner_schedule_id" t-as="schedule">
                                            <a t-att-href="'/mydoc/download?attachment_id=%i' % schedule['id']"><t t-esc="schedule['datas_fname']"/></a>
                                            <!-- <a><t t-esc="schedule['datas_fname']"/></a> -->
                                        </t>
                                        </t>
                                    </div>
                                </div>
                                
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="warranty_time">Баталгаат хугацаа (Сараар):</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><t t-if="not part_tenders.warranty_time"><input type="text" class="form-control" placeholder="Баталгаат хугацаа (Сараар)" name="warranty_time" required=""/></t></t>
                                        <t t-if="part_tenders.state == 'draft'"><t t-if="part_tenders.warranty_time"><input type="text" class="form-control" placeholder="Баталгаат хугацаа (Сараар)" name="warranty_time" t-att-value="part_tenders.warranty_time" required=""/></t></t>
                                        <t t-if="part_tenders.state != 'draft'"><t t-if="part_tenders.warranty_time"><input type="text" class="form-control" placeholder="Баталгаат хугацаа (Сараар)" name="warranty_time" t-att-value="part_tenders.warranty_time" readonly=""/></t></t>
                                    </div>
                                </div>
                                <div class="form-group required">
                                    <label class="col-md-3 col-sm-4 control-label" for="execute_time">Гүйцэтгэх хугацаа (Хуанлийн хоногоор):</label>
                                    <div class="col-md-7 col-sm-8">
                                        <t t-if="part_tenders.state == 'draft'"><t t-if="not part_tenders.execute_time"><input type="text" class="form-control" placeholder="Гүйцэтгэх хугацаа (Хуанлийн хоногоор)" name="execute_time" required=""/></t></t>
                                        <t t-if="part_tenders.state == 'draft'"><t t-if="part_tenders.execute_time"><input type="text" class="form-control" placeholder="Гүйцэтгэх хугацаа (Хуанлийн хоногоор)" name="execute_time" t-att-value="part_tenders.execute_time" required=""/></t></t>
                                        <t t-if="part_tenders.state != 'draft'"><t t-if="part_tenders.execute_time"><input type="text" class="form-control" placeholder="Гүйцэтгэх хугацаа (Хуанлийн хоногоор)" name="execute_time" t-att-value="part_tenders.execute_time" readonly=""/></t></t>
                                    </div>
                                </div>
                                <hr/>
                                <h3 class="pagetitle">Үнийн саналын задаргаа</h3>
                                <div class="table-responsive">
                                    <table class="table table-condensed table-striped" style="width: auto;">
                                        <tbody id ="tasktable">
                                        <tr class="info">
                                            <td rowspan="2" width="5%">#</td>
                                            <td rowspan="2" width="25%">Ажил үйлчилгээний нэр</td>
                                            <td colspan="3" width="30%">Ажиллах хүчний зардал</td>
                                            <td rowspan="2">Материалын зардал</td>
                                            <td rowspan="2">Бусад зардал</td>
                                            <td rowspan="2">Нийт зардал</td>
                                            <td t-if="part_tenders.state == 'draft'" rowspan="2">Үйлдэл</td>
                                        </tr>
                                        <tr class="info">
                                            <td style="text-align: right;">Тоо хэмжээ</td>
                                            <td style="text-align: right;">Hэгж үнэ</td>
                                            <td style="text-align: right;">Нийт үнэ</td>
                                        </tr>
        <t t-if='lines'><t t-foreach="lines" t-as="line"><tr t-att-id="line['id']"><t t-if="part_tenders.state == 'draft'"><td><input type="hidden" t-att-name="'hiddn%d'%(line_index+1)" t-att-value="'%d'%line['id']" /><span><t t-set="foo" t-value="line_index + 1"/><t t-esc="foo"></t></span></td><td><input t-att-name="'work%d'%(line_index+1)" t-att-value="line['name']"></input></td><td><input class="quantity" onkeyup="calculate(event)" onfocus="value_mandatory(event)" t-att-value="line['qty']" t-att-name="'hemjee%d'%(line_index+1)" style="width: 60px;"></input></td><td><input class="unitprice" onkeyup="calculate(event)" onfocus="value_mandatory(event)" t-att-value="line['unit_price']" t-att-name="'negjune%d'%(line_index+1)" style="width: 60px;"></input></td><td class="totalcost"><t t-esc="line['amount']"/></td><td><input class="materialexpense" onkeyup="calculate(event)" onfocus="value_mandatory(event)" t-att-value="line['costs_of_materials']" t-att-name="'material%d'%(line_index+1)" style="width: 60px;"></input></td><td><input class="otherexpense" onkeyup="calculate(event)" onfocus="value_mandatory(event)" t-att-value="line['other_costs']" t-att-name="'busadzardal%d'%(line_index+1)" style="width: 60px;"></input></td><td class="totalsum"><t t-esc="line['line_total_amount']"/></td><td><t t-if="line_index==0"><label onclick="add_task()">Мөр нэмэх</label></t><t t-if="line_index!=0"><button type="button" onclick="remove_row(event, true); return false;" t-att-id='"%d"%(line_index+1)' class="delete">Устгах</button></t></td></t>
        <t t-if="part_tenders.state != 'draft'">
                                                <td><span t-esc="line_index+1"/></td>
                                                <td><t t-if="line.name"><span t-esc="line.name"/></t></td>
                                                <td><t t-if="line.qty"><span t-esc="line.qty"/></t></td>
                                                <td><t t-if="line.unit_price"><span t-esc="line.unit_price"/></t></td>
                                                <td><t t-if="line.amount"><span t-esc="line.amount"/></t></td>
                                                <td><t t-if="line.costs_of_materials"><span t-esc="line.costs_of_materials"/></t></td>
                                                <td><t t-if="line.other_costs"><span t-esc="line.other_costs"/></t></td>
                                                <td><t t-if="line.line_total_amount"><span t-esc="line.line_total_amount"/></t></td>
                                            </t></tr></t></t>					        
                                        </tbody>	
                                    </table>
                                    <t t-if="part_tenders.state == 'draft'"><div class="bb2 mb-15" style="background-color: #cccccc;">Нийт дүн: <span id="totalvalue" class="font24 text-danger" style="float: right; padding-top:2px;" t-esc="part_tenders.amount_total">0₮</span></div></t>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-offset-3 col-sm-offset-4 col-sm-8 col-md-7">
                                        <t t-if="part_tenders.state == 'draft'"><button class="btn btn-primary btn-md" type="submit">Хадгалах</button></t>
                                        <t t-if="part_tenders.state == 'draft'"><a t-attf-href="/my/tender_documents/#{ slug(tender) }" class="btn btn-default" type="button">Болих</a></t>
                                    </div>
                                    <div class="col-sm-8 col-md-7">
                                        <t t-if="part_tenders.state != 'draft'"><a t-attf-href="/tender_detail/#{ slug(tender) }" class="btn btn-info btn-md" type="button">Тендерийн дэлгэрэнгүй</a></t>
                                        <t t-if="part_tenders.state != 'draft'"><a t-attf-href="/my/tenders_documents/" class="btn btn-success btn-md" type="button">Өөрийн оролцсон тендерүүд</a></t>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-sm-3 col-md-3">
                            <t t-call="nomin_web.my_account"/>
                        </div>
                    
                        </div>
                    </div>
                </div>
                </div>

            </t>
            <script type="text/javascript">
            <![CDATA[
            
                function value_mandatory(event)
                    {
                        if(event.target.value==0)
                            event.target.value="";
                    }
                    
                var a;
                function calculate(event)
                    {
                        if(event.target.className=="unitprice")
                            {a=Number(event.target.value)*Number(event.target.parentNode.previousSibling.childNodes[0].value);
                                event.target.parentNode.nextSibling.innerHTML=a;
                                event.target.parentNode.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML=Number(event.target.parentNode.nextSibling.nextSibling.nextSibling.childNodes[0].value)+a;
                            }
                            
                        if(event.target.className=="quantity")
                            {a=Number(event.target.value)*Number(event.target.parentNode.nextSibling.childNodes[0].value);
                                event.target.parentNode.nextSibling.nextSibling.innerHTML=a;
                                event.target.parentNode.nextSibling.nextSibling.nextSibling.nextSibling.nextSibling.innerHTML=Number(event.target.parentNode.nextSibling.nextSibling.nextSibling.nextSibling.childNodes[0].value)+a;
                            }
                            
                        if(event.target.className=="otherexpense")
                            {
                                event.target.parentNode.nextSibling.innerHTML=Number(event.target.value)+Number(event.target.parentNode.previousSibling.previousSibling.innerHTML)+Number(event.target.parentNode.previousSibling.childNodes[0].value);
                            }
                            
                        if(event.target.className=="materialexpense")
                            {
                                event.target.parentNode.nextSibling.nextSibling.innerHTML= Number(event.target.value)+Number(event.target.parentNode.previousSibling.innerHTML)+Number(event.target.parentNode.nextSibling.childNodes[0].value);
                            }
                            
                            total_sum();
                    }
                    
                var numberx=1;
                function add_task()
                    {
                        $("#tasktable").append('<tr><td>'+numberx+'</td><td><input name="workx'+numberx+'"></input></td><td><input class="quantity" onkeyup="calculate(event)" onfocus="value_mandatory(event)" value="0" name="hemjeex'+numberx+'" style="width: 60px;"></input></td><td><input class="unitprice" onkeyup="calculate(event)" onfocus="value_mandatory(event)" value="0" name="negjunex'+numberx+'" style="width: 60px;"></input></td><td class="totalcost">0</td><td><input class="materialexpense" onkeyup="calculate(event)" onfocus="value_mandatory(event)" value="0" name="materialx'+numberx+'" style="width: 60px;"></input></td><td><input class="otherexpense" onkeyup="calculate(event)" onfocus="value_mandatory(event)" value="0" name="busadzardalx'+numberx+'" style="width: 60px;"></input></td><td class="totalsum">0</td><td><button type="button" id=x'+numberx+' onclick="remove_row(event, false); return false;" class="deletex">Устгах</button></td></tr>' );
                        numberx++;
                    }
                    
                function remove_row(event, bolen)
                    {
                            if(bolen)
                            {
                            for(var i=Number(event.target.id); i<=document.getElementsByClassName("delete").length; i++)
                                {
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[0].childNodes[0].name="hiddn"+i;
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[0].childNodes[1].innerHTML=i;
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[1].childNodes[0].name="work"+i;
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[2].childNodes[0].name="hemjee"+i;
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[3].childNodes[0].name="negjune"+i;
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[5].childNodes[0].name="material"+i;
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[6].childNodes[0].name="busadzardal"+i;
                                    document.getElementById(i+1).parentNode.parentNode.childNodes[8].childNodes[0].id=i;
                                }
                                    
                            }
                            else
                            {
                            for(var i=Number(event.target.id.split("x")[1]); i<document.getElementsByClassName("deletex").length; i++)
                                {
                                    document.getElementById("x"+(i+1)).parentNode.parentNode.childNodes[0].innerHTML=i;
                                    document.getElementById("x"+(i+1)).parentNode.parentNode.childNodes[1].childNodes[0].name="workx"+i;
                                    document.getElementById("x"+(i+1)).parentNode.parentNode.childNodes[2].childNodes[0].name="hemjeex"+i;
                                    document.getElementById("x"+(i+1)).parentNode.parentNode.childNodes[3].childNodes[0].name="negjunex"+i;
                                    document.getElementById("x"+(i+1)).parentNode.parentNode.childNodes[5].childNodes[0].name="materialx"+i;
                                    document.getElementById("x"+(i+1)).parentNode.parentNode.childNodes[6].childNodes[0].name="busadzardalx"+i;
                                    document.getElementById("x"+(i+1)).parentNode.parentNode.childNodes[8].childNodes[0].id="x"+i;
                                }
                                numberx--;
                            }
                        document.getElementById("tasktable").removeChild(event.target.parentNode.parentNode);
                        total_sum();
                    }
                    
                var b;
                function total_sum()
                    {
                        a=document.getElementsByClassName("totalsum")
                        b=Number(a[0].innerHTML);
                        for(var i=1; i<a.length; i++)
                            {
                                b+=Number(a[i].innerHTML);
                            }
                        $("#totalvalue").html(b.toLocaleString()+"₮");
                    }
            ]]>	
            </script>
        </template>
    </data>
</odoo>